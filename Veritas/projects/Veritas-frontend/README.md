# Veritas Protocol — Frontend

**React 18 + TypeScript + TailwindCSS UI for the Veritas on-chain visual copyright registry.**

[![Deployed on Vercel](https://img.shields.io/badge/Deployed%20on-Vercel-000000?style=flat-square&logo=vercel)](https://veritas-3.vercel.app)
[![Algorand Testnet](https://img.shields.io/badge/Algorand-Testnet-00BFD8?style=flat-square)](https://testnet.algoexplorer.io/application/755787017)

---

## Tech Stack

| Layer | Technology |
|---|---|
| Framework | React 18, TypeScript 5 |
| Build Tool | Vite 5 |
| Styling | TailwindCSS 3 + DaisyUI 4 |
| Wallet | `@perawallet/connect` + `@txnlab/use-wallet-react` |
| Algorand SDK | `algosdk` v3 |
| Notifications | `notistack` |
| Deployment | Vercel (pure Vite build, no Python) |

---

## Project Structure

```
src/
├── App.tsx                  ← Main app — all API calls, registration, verification, analyze
├── Home.tsx                 ← Landing page / hero
├── main.tsx                 ← WalletManager provider setup
├── components/
│   ├── ConnectWallet.tsx    ← Pera Wallet modal
│   ├── Account.tsx          ← Connected wallet address + Lora explorer link
│   ├── AppCalls.tsx         ← ATC transaction builder for register_work()
│   ├── Transact.tsx         ← Generic payment transaction
│   └── ErrorBoundary.tsx    ← Top-level React error boundary
├── contracts/
│   └── VeritasRegistry.ts   ← ARC-4 typed client (generated by algokit)
├── interfaces/
│   └── network.ts           ← Network config types
└── utils/
    ├── ellipseAddress.ts    ← Address truncation helper
    └── network/
        └── getAlgoClientConfigs.ts
```

---

## Pera Wallet Integration

The app uses `@txnlab/use-wallet-react` with `@perawallet/connect` as the active provider:

```tsx
// main.tsx
<WalletProvider manager={new WalletManager({ wallets: [PROVIDER_ID.PERA] })}>
  <App />
</WalletProvider>
```

When registering artwork, the frontend:
1. POSTs the image to `/compute-hash` on the backend → receives 64-bit pHash hex
2. Fetches `SuggestedParams` from `/algod/params` (backend proxy to AlgoNode)
3. Builds an ATC (`AtomicTransactionComposer`) with a `register_work(phash)` ABI call + MBR funding transaction
4. Sends to Pera Wallet for signing via `atc.gatherSignatures()` → `peraWallet.signTransaction()`
5. Submits the signed group to Algorand Testnet

---

## Environment Variables

| Variable | Purpose | Default |
|---|---|---|
| `VITE_API_URL` | Backend API base URL | `https://veritas-api-vgus.onrender.com` |

Create `.env.local` for local development:

```env
VITE_API_URL=http://localhost:8000
```

---

## Running Locally

**Prerequisites:** Node.js ≥ 20, npm ≥ 9

```bash
# 1. Navigate to frontend
cd Veritas/projects/Veritas-frontend

# 2. Install dependencies
npm install

# 3. (Optional) point at local backend
echo "VITE_API_URL=http://localhost:8000" > .env.local

# 4. Start dev server
npx vite
# App runs at http://localhost:5173
```

```bash
# Build for production
npx vite build

# Preview production build
npx vite preview
```

---

## Key Design Decisions

**No Python on Vercel** — All AI/forensic processing happens on the Render backend. Vercel build time is ~30 seconds (vs 8+ minutes with Python serverless functions).

**AlgoNode proxy via backend** — Direct browser calls to `testnet-api.algonode.cloud` are geo-blocked on some networks. All Algod calls are proxied through the FastAPI backend at `/algod/params` and `/algod/account/{address}`.

**`let id` polling pattern** — The backend cold-starts on Render's free tier. The app polls `/registry` every 5s and shows a wake-up banner until the backend responds. `let id` is declared before `setInterval` so `clearInterval` always holds a valid reference.

**`genesisHash` as `Uint8Array`** — AlgoNode returns `genesis-hash` as a base64 string. algosdk v3 requires a raw `Uint8Array`. Mapped explicitly: `Uint8Array.from(atob(raw['genesis-hash']), c => c.charCodeAt(0))`.

### Initial Setup

#### 1. Clone the Repository
Start by cloning this repository to your local machine.

#### 2. Install Pre-requisites
Ensure the following pre-requisites are installed and properly configured:

- **npm**: Node package manager. Install from [Node.js Installation Guide](https://nodejs.org/en/download/). Verify with `npm -v` to see version `18.12`+.
- **AlgoKit CLI**: Essential for project setup and operations. Install the latest version from [AlgoKit CLI Installation Guide](https://github.com/algorandfoundation/algokit-cli#install). Verify installation with `algokit --version`, expecting `2.0.0` or later.

#### 3. Bootstrap Your Local Environment
Run the following commands within the project folder:

- **Install Project Dependencies**: With `algokit project bootstrap all`, ensure all dependencies are ready.

### Development Workflow

#### Terminal
Directly manage and interact with your project using AlgoKit commands:

1. **Build Contracts**: `algokit project run build` builds react web app and links with smart contracts in workspace, if any.
2. Remaining set of command for linting, testing and deployment can be found in respective [package.json](./package.json) file and [.algokit.toml](./.algokit.toml) files.

#### VS Code
For a seamless experience with breakpoint debugging and other features:

1. **Open Project**: In VS Code, open the repository root.
2. **Install Extensions**: Follow prompts to install recommended extensions.
3. **Debugging**:
   - Use `F5` to start debugging.
   - **Windows Users**: Select the Python interpreter at `./.venv/Scripts/python.exe` via `Ctrl/Cmd + Shift + P` > `Python: Select Interpreter` before the first run.

#### Other IDEs
While primarily optimized for VS Code, Jetbrains WebStorm has base support for this project:

1. **Open Project**: In your JetBrains IDE, open the repository root.
2. **Automatic Setup**: The IDE should configure the Python interpreter and virtual environment.
3. **Debugging**: Use `Shift+F10` or `Ctrl+R` to start debugging. Note: Windows users may encounter issues with pre-launch tasks due to a known bug. See [JetBrains forums](https://youtrack.jetbrains.com/issue/IDEA-277486/Shell-script-configuration-cannot-run-as-before-launch-task) for workarounds.

## AlgoKit Workspaces and Project Management
This project supports both standalone and monorepo setups through AlgoKit workspaces. Leverage [`algokit project run`](https://github.com/algorandfoundation/algokit-cli/blob/main/docs/features/project/run.md) commands for efficient monorepo project orchestration and management across multiple projects within a workspace.

> Please note, by default frontend is pre configured to run against Algorand LocalNet. If you want to run against TestNet or MainNet, comment out the current environment variable and uncomment the relevant one in [`.env`](.env) file that is created after running bootstrap command and based on [`.env.template`](.env.template).

# Algorand Wallet integrations

The template comes with [`use-wallet`](https://github.com/txnlab/use-wallet) integration, which provides a React hook for connecting to an Algorand wallet providers. The following wallet providers are included by default:
- LocalNet:
- - [KMD/Local Wallet](https://github.com/TxnLab/use-wallet#kmd-algorand-key-management-daemon) - Algorand's Key Management Daemon (KMD) is a service that manages Algorand private keys and signs transactions. Works best with AlgoKit LocalNet and allows you to easily test and interact with your dApps locally.
- TestNet and others:
- - [Pera Wallet](https://perawallet.app).
- - [Defly Wallet](https://defly.app).
- - [Exodus Wallet](https://www.exodus.com).
- - [Daffi Wallet](https://www.daffi.me).

Refer to official [`use-wallet`](https://github.com/txnlab/use-wallet) documentation for detailed guidelines on how to integrate with other wallet providers (such as WalletConnect v2). Too see implementation details on the use wallet hook and initialization of extra wallet providers refer to [`App.tsx`](./src/App.tsx).

# Tools

This project makes use of React and Tailwind to provider a base project configuration to develop frontends for your Algorand dApps and interactions with smart contracts. The following tools are in use:

- [AlgoKit Utils](https://github.com/algorandfoundation/algokit-utils-ts) - Various TypeScript utilities to simplify interactions with Algorand and AlgoKit.
- [React](https://reactjs.org/) - A JavaScript library for building user interfaces.
- [use-wallet](https://github.com/txnlab/use-wallet) - A React hook for connecting to an Algorand wallet providers.
- [npm](https://www.npmjs.com/): Node.js package manager
It has also been configured to have a productive dev experience out of the box in [VS Code](https://code.visualstudio.com/), see the [.vscode](./.vscode) folder.
# Integrating with smart contracts and application clients

Refer to the detailed guidance on [integrating with smart contracts and application clients](./src/contracts/README.md). In essence, for any smart contract codebase generated with AlgoKit or other tools that produce compile contracts into ARC34 compliant app specifications, you can use the `algokit generate` command to generate TypeScript or Python typed client. Once generated simply drag and drop the generated client into `./src/contracts` and import it into your React components as you see fit.
